<!DOCTYPE html>
<html lang="en">
  <head>
    <meta name="description"><meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='http://fonts.googleapis.com/css?family=Roboto' rel='stylesheet' type='text/css'>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="/assets/styles/html5reset.css" media="all">
    <link rel="stylesheet" href="/assets/styles/responsivegridsystem.css" media="all">
    <link rel="stylesheet" href="/assets/styles/6cols.css" media="all">
    <!-- Responsive Stylesheets -->
    <link rel="stylesheet" media="only screen and (max-width: 1024px) and (min-width: 769px)" href="/assets/styles/1024.css">
    <link rel="stylesheet" media="only screen and (max-width: 768px) and (min-width: 481px)" href="/assets/styles/768.css">
    <link rel="stylesheet" media="only screen and (max-width: 480px)" href="/assets/styles/480.css">
    <!-- All JavaScript at the bottom, except for Modernizr which enables HTML5 elements and feature detects -->
    <script src="/assets/scripts/modernizr-2.5.3-min.js"></script><link rel="stylesheet" type="text/css" href="/assets/styles/menu_sideslide.css" />
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="/assets/styles/code_block.css" />
    <link rel="stylesheet" href="/assets/styles/search.css">
    <link rel="stylesheet" href="/assets/styles/code_example.css">
    <title>Ketai Library - Bluetooth Connection</title>
  </head>
</html>
<body>
<div class="menu-wrap">
  <nav class="menu">
    <div class="icon-list">
<ul class="menu"> 
  <div>
    <li><a href="/">Home</a></li>
    <li><a href="/get-started/">Get Started</a></li>
    <li><a href="/examples/">Examples</a></li>
    <li><a href="/tutorials/">Tutorials</a></li>
    <li><a href="/reference/">Reference</a></li>
    <li><a href="/download/">Download</a></li>
    <li><a href="/exhibition/">Exhibition</a></li><br/>
    <script src="/assets/scripts/google_search.js"></script><gcse:search enableAutoComplete="true"></gcse:search>
    
    <br/>
    <li><a href="https://github.com/ketai/library" class="misc_link"><i class="fa fa-github"> Github</i></a></li>
    <li><a href="https://github.com/ketai/ketai/pulls" class="misc_link"><i class="fa fa-code"> Your Help</i></a></li>
    <li><a href="https://github.com/ketai/ketai/issues" class="misc_link"><i class="fa fa-comment-o"> Forum</i></a></li>
    <li><a href="https://twitter.com/ketailibrary" class="misc_link"><i class="fa fa-twitter"> Twitter</i></a></li>
    <li><a href="https://www.mobileprocessing.org" class="misc_link"><i class="fa fa-book"> RAD Book </i></a></li>
  </div>
</ul>
    </div>
  </nav>
  <button id="close-button" class="close-button">Close Menu</button>
</div>
<button id="open-button" class="menu-button">Open Menu</button>
<div class="title">
  <nav class="menu"></nav>
</div>
  <div id="wrapper">
    <div class="title">
      <h2>Ketai</h2>
    </div>
    <div id="maincontentcontainer">
      <div class="maincontent">
        <div class="section group">
          <div class="col span_1_of_6 menubar"><a href="/"><img src="/assets/images/ketai_black.png" class="top"><img src="/assets/images/ketai_v12.png" class="bottom"></a>
<ul class="menu"> 
  <div>
    <li><a href="/">Home</a></li>
    <li><a href="/get-started/">Get Started</a></li>
    <li><a href="/examples/">Examples</a></li>
    <li><a href="/tutorials/">Tutorials</a></li>
    <li><a href="/reference/">Reference</a></li>
    <li><a href="/download/">Download</a></li>
    <li><a href="/exhibition/">Exhibition</a></li><br/>
    <script src="/assets/scripts/google_search.js"></script><gcse:search enableAutoComplete="true"></gcse:search>
    
    <br/>
    <li><a href="https://github.com/ketai/library" class="misc_link"><i class="fa fa-github"> Github</i></a></li>
    <li><a href="https://github.com/ketai/ketai/pulls" class="misc_link"><i class="fa fa-code"> Your Help</i></a></li>
    <li><a href="https://github.com/ketai/ketai/issues" class="misc_link"><i class="fa fa-comment-o"> Forum</i></a></li>
    <li><a href="https://twitter.com/ketailibrary" class="misc_link"><i class="fa fa-twitter"> Twitter</i></a></li>
    <li><a href="https://www.mobileprocessing.org" class="misc_link"><i class="fa fa-book"> RAD Book </i></a></li>
  </div>
</ul>
            <hr>
<h4><b>Other Examples:</b></h4>
<ul class="sidelist_menu">
  <li><a href="/examples/accelerometer/">Accelerometer</a></li>
  <li><a href="/examples/audioinput/">Audio Input</a></li>
  <li><a href="/examples/bluetoothcursors/" class="active">Bluetooth Connection</a></li>
  <li><a href="/examples/cameragettingstarted/">Getting Camera Started</a></li>
  <li><a href="/examples/datacapture/">Data Capture</a></li>
  <li><a href="/examples/externalsqliteloading/">External SQLite Tables</a></li>
  <li><a href="/examples/facedetector/">Face Detector</a></li>
  <li><a href="/examples/geolocation/">Geolocation</a></li>
  <li><a href="/examples/gestures/">Gestures</a></li>
  <li><a href="/examples/gyroscope/">Gyroscope</a></li>
  <li><a href="/examples/locationdistance/">Location Distance</a></li>
  <li><a href="/examples/multiplesensors/">Multiple Sensors</a></li>
  <li><a href="/examples/nfcbeam/">NFC Beam</a></li>
  <li><a href="/examples/nfcread/">NFC Read</a></li>
  <li><a href="/examples/nfcwrite/">NFC Write</a></li>
  <li><a href="/examples/sqlite/">SQLite</a></li>
  <li><a href="/examples/ui/">UI</a></li>
  <li><a href="/examples/wifidirect-remotecursor/">WiFi Direct - Remote Cursor</a></li>
</ul>
          </div>
          <div class="col span_4_of_6 reference">
            <h3>Examples</h3><h4 id="bluetooth-connection">Bluetooth Connection</h4>
<p>This example illustrates how to use Bluetooth Connection</p>
<hr>
<div class="link"><a href="BluetoothCursors.pde"><i class="fa fa-download fa-lg"></i> BluetoothCursors. pde</a></div>

<pre><code>/**
 * &lt;p&gt;Ketai Library for Android: http://ketai.org&lt;/p&gt;
 *
 * &lt;p&gt;KetaiBluetooth wraps the Android Bluetooth RFCOMM Features:
 * &lt;ul&gt;
 * &lt;li&gt;Enables Bluetooth for sketch through android&lt;/li&gt;
 * &lt;li&gt;Provides list of available Devices&lt;/li&gt;
 * &lt;li&gt;Enables Discovery&lt;/li&gt;
 * &lt;li&gt;Allows writing data to device&lt;/li&gt;
 * &lt;/ul&gt;
 * &lt;p&gt;Updated: 2012-05-18 Daniel Sauter/j.duran&lt;/p&gt;
 */

//required for BT enabling on startup
import android.content.Intent;
import android.os.Bundle;

import ketai.net.bluetooth.*;
import ketai.ui.*;
import ketai.net.*;

import oscP5.*;

KetaiBluetooth bt;
String info = &quot;&quot;;
KetaiList klist;
PVector remoteMouse = new PVector();

ArrayList&lt;String&gt; devicesDiscovered = new ArrayList();
boolean isConfiguring = true;
String UIText;

//********************************************************************
// The following code is required to enable bluetooth at startup.
//********************************************************************
void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  bt = new KetaiBluetooth(this);
}

void onActivityResult(int requestCode, int resultCode, Intent data) {
  bt.onActivityResult(requestCode, resultCode, data);
}

//********************************************************************

void setup()
{   
  orientation(PORTRAIT);
  background(78, 93, 75);
  stroke(255);
  textSize(24);

  //start listening for BT connections
  bt.start();

  UIText =  &quot;d - discover devices\n&quot; +
    &quot;b - make this device discoverable\n&quot; +
    &quot;c - connect to device\n     from discovered list.\n&quot; +
    &quot;p - list paired devices\n&quot; +
    &quot;i - Bluetooth info&quot;;
}

void draw()
{
  if (isConfiguring)
  {
    ArrayList&lt;String&gt; names;
    background(78, 93, 75);

    //based on last key pressed lets display
    //  appropriately
    if (key == &#39;i&#39;)
      info = getBluetoothInformation();
    else
    {
      if (key == &#39;p&#39;)
      {
        info = &quot;Paired Devices:\n&quot;;
        names = bt.getPairedDeviceNames();
      }
      else
      {
        info = &quot;Discovered Devices:\n&quot;;
        names = bt.getDiscoveredDeviceNames();
      }

      for (int i=0; i &lt; names.size(); i++)
      {
        info += &quot;[&quot;+i+&quot;] &quot;+names.get(i).toString() + &quot;\n&quot;;
      }
    }
    text(UIText + &quot;\n\n&quot; + info, 5, 90);
  }
  else
  {
    background(78, 93, 75);
    pushStyle();
    fill(255);
    ellipse(mouseX, mouseY, 20, 20);
    fill(0, 255, 0);
    stroke(0, 255, 0);
    ellipse(remoteMouse.x, remoteMouse.y, 20, 20);    
    popStyle();
  }

  drawUI();
}


//Call back method to manage data received
void onBluetoothDataEvent(String who, byte[] data)
{
  if (isConfiguring)
    return;

  //KetaiOSCMessage is the same as OscMessage
  //   but allows construction by byte array
  KetaiOSCMessage m = new KetaiOSCMessage(data);
  if (m.isValid())
  {
    if (m.checkAddrPattern(&quot;/remoteMouse/&quot;))
    {
      if (m.checkTypetag(&quot;ii&quot;))
      {
        remoteMouse.x = m.get(0).intValue();
        remoteMouse.y = m.get(1).intValue();
      }
    }
  }
}

String getBluetoothInformation()
{
  String btInfo = &quot;Server Running: &quot;;
  btInfo += bt.isStarted() + &quot;\n&quot;;
  btInfo += &quot;Discovering: &quot; + bt.isDiscovering() + &quot;\n&quot;;
  btInfo += &quot;Device Discoverable: &quot;+bt.isDiscoverable() + &quot;\n&quot;;
  btInfo += &quot;\nConnected Devices: \n&quot;;

  ArrayList&lt;String&gt; devices = bt.getConnectedDeviceNames();
  for (String device: devices)
  {
    btInfo+= device+&quot;\n&quot;;
  }

  return btInfo;
}
</code></pre><hr>
<div class="link"><a href="UI.pde"><i class="fa fa-download fa-lg"></i> UI. pde</a></div>

<pre><code>/*  UI-related functions */


void mousePressed()
{
  //keyboard button -- toggle virtual keyboard
  if (mouseY &lt;= 50 &amp;&amp; mouseX &gt; 0 &amp;&amp; mouseX &lt; width/3)
    KetaiKeyboard.toggle(this);
  else if (mouseY &lt;= 50 &amp;&amp; mouseX &gt; width/3 &amp;&amp; mouseX &lt; 2*(width/3)) //config button
  {
    isConfiguring=true;
  }
  else if (mouseY &lt;= 50 &amp;&amp; mouseX &gt;  2*(width/3) &amp;&amp; mouseX &lt; width) // draw button
  {
    if (isConfiguring)
    {
      //if we&#39;re entering draw mode then clear canvas
      background(78, 93, 75);
      isConfiguring=false;
    }
  }
}

void mouseDragged()
{
  if (isConfiguring)
    return;

  //send data to everyone
  //  we could send to a specific device through
  //   the writeToDevice(String _devName, byte[] data)
  //  method.
  OscMessage m = new OscMessage(&quot;/remoteMouse/&quot;);
  m.add(mouseX);
  m.add(mouseY);

  bt.broadcast(m.getBytes());
  ellipse(mouseX, mouseY, 20, 20);
}

public void keyPressed() {
  if (key ==&#39;c&#39;)
  {
    //If we have not discovered any devices, try prior paired devices
    if (bt.getDiscoveredDeviceNames().size() &gt; 0)
      klist = new KetaiList(this, bt.getDiscoveredDeviceNames());
    else if (bt.getPairedDeviceNames().size() &gt; 0)
      klist = new KetaiList(this, bt.getPairedDeviceNames());
  }
  else if (key == &#39;d&#39;)
  {
    bt.discoverDevices();
  }
  else if (key == &#39;x&#39;)
    bt.stop();
  else if (key == &#39;b&#39;)
  {
    bt.makeDiscoverable();
  }
  else if (key == &#39;s&#39;)
  {
    bt.start();
  }
}


void drawUI()
{
  //Draw top shelf UI buttons

  pushStyle();
  fill(0);
  stroke(255);
  rect(0, 0, width/3, 50);

  if (isConfiguring)
  {
    noStroke();
    fill(78, 93, 75);
  }
  else
    fill(0);

  rect(width/3, 0, width/3, 50);

  if (!isConfiguring)
  {  
    noStroke();
    fill(78, 93, 75);
  }
  else
  {
    fill(0);
    stroke(255);
  }
  rect((width/3)*2, 0, width/3, 50);

  fill(255);
  text(&quot;Keyboard&quot;, 5, 30); 
  text(&quot;Bluetooth&quot;, width/3+5, 30); 
  text(&quot;Interact&quot;, width/3*2+5, 30); 

  popStyle();
}

void onKetaiListSelection(KetaiList klist)
{
  String selection = klist.getSelection();
  bt.connectToDeviceByName(selection);

  //dispose of list for now
  klist = null;
}
</code></pre><!-- * **Screenshot** --><img src="/assets/thumbnails/820559963e349ba026fc5f4feeca0ac7.png" width="480" height="800"></img>
          </div>
        </div>
      </div>
    </div>
  </div><script src="/assets/scripts/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  
  
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <script>window.jQuery || document.write('<script src="/assets/scripts/jquery-1.7.2.min.js"><\/script>')</script>
  <script src="/assets/scripts/classie.js"></script>
  <script src="/assets/scripts/menu.js"></script>
  <script src="/assets/scripts/responsivegridsystem.js"></script>
</body>